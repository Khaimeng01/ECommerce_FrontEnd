import { __decorate, __param } from "tslib";
import { Directive, ElementRef, Renderer2, Input, NgZone, Inject, PLATFORM_ID, OnInit, OnDestroy } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
/**
 * Angular Lazy Loading Images Directive
 *
 * The library allows to lazy load images from your web application
 * using the MutationObserver and the IntersectionObserver. Images will be loaded as
 * soon as they enter the viewport in a non-blocking way.
 */
var LazyLoadImagesDirective = /** @class */ (function () {
    function LazyLoadImagesDirective(element, renderer, ngZone, platformId) {
        this.renderer = renderer;
        this.ngZone = ngZone;
        this.platformId = platformId;
        this.rootElement = element.nativeElement;
    }
    LazyLoadImagesDirective.prototype.init = function () {
        var _this = this;
        this.registerIntersectionObserver();
        this.observeDOMChanges(this.rootElement, function () {
            var imagesFoundInDOM = _this.getAllImagesToLazyLoad(_this.rootElement);
            imagesFoundInDOM.forEach(function (image) { return _this.intersectionObserver.observe(image); });
        });
    };
    LazyLoadImagesDirective.prototype.ngOnInit = function () {
        var _this = this;
        if (!this.isBrowser()) {
            return;
        }
        require('intersection-observer');
        this.ngZone.runOutsideAngular(function () { return _this.init(); });
    };
    LazyLoadImagesDirective.prototype.ngOnDestroy = function () {
        if (this.intersectionObserver) {
            this.intersectionObserver.disconnect();
        }
    };
    LazyLoadImagesDirective.prototype.isBrowser = function () {
        return isPlatformBrowser(this.platformId);
    };
    LazyLoadImagesDirective.prototype.registerIntersectionObserver = function () {
        var _this = this;
        this.intersectionObserver = new IntersectionObserver(function (images) { return images.forEach(function (image) { return _this.onIntersectionChange(image); }); }, this.intersectionObserverConfig instanceof Object ? this.intersectionObserverConfig : undefined);
        return this.intersectionObserver;
    };
    LazyLoadImagesDirective.prototype.observeDOMChanges = function (rootElement, onChange) {
        // Create a Mutation Observer instance
        var observer = new MutationObserver(function () { return onChange(); });
        // Observer Configuration
        var observerConfig = {
            attributes: true,
            characterData: true,
            childList: true,
            subtree: true
        };
        // Observe Directive DOM Node
        observer.observe(rootElement, observerConfig);
        // Fire onChange callback to check current DOM nodes
        onChange();
        return observer;
    };
    LazyLoadImagesDirective.prototype.getAllImagesToLazyLoad = function (pageNode) {
        return Array.from(pageNode.querySelectorAll('img[data-src], [data-srcset], [data-background-src]'));
    };
    LazyLoadImagesDirective.prototype.onIntersectionChange = function (image) {
        if (!image.isIntersecting) {
            return;
        }
        this.onImageAppearsInViewport(image.target);
    };
    LazyLoadImagesDirective.prototype.onImageAppearsInViewport = function (image) {
        if (image.dataset.src) {
            this.renderer.setAttribute(image, 'src', image.dataset.src);
            this.renderer.removeAttribute(image, 'data-src');
        }
        if (image.dataset.srcset) {
            this.renderer.setAttribute(image, 'srcset', image.dataset.srcset);
            this.renderer.removeAttribute(image, 'data-srcset');
        }
        if (image.dataset.backgroundSrc) {
            this.renderer.setStyle(image, 'background-image', "url(" + image.dataset.backgroundSrc + ")");
            this.renderer.removeAttribute(image, 'data-background-src');
        }
        // Stop observing the current target
        if (this.intersectionObserver) {
            this.intersectionObserver.unobserve(image);
        }
    };
    LazyLoadImagesDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NgZone },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    __decorate([
        Input('lazy-load-images')
    ], LazyLoadImagesDirective.prototype, "intersectionObserverConfig", void 0);
    LazyLoadImagesDirective = __decorate([
        Directive({
            selector: '[lazy-load-images]'
        }),
        __param(3, Inject(PLATFORM_ID))
    ], LazyLoadImagesDirective);
    return LazyLoadImagesDirective;
}());
export { LazyLoadImagesDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWxhenktbG9hZC1pbWFnZXMuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWxhenktbG9hZC1pbWFnZXMvIiwic291cmNlcyI6WyJsaWIvbmd4LWxhenktbG9hZC1pbWFnZXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFJcEQ7Ozs7OztHQU1HO0FBSUg7SUFNRSxpQ0FDRSxPQUFtQixFQUNaLFFBQW1CLEVBQ25CLE1BQWMsRUFDUSxVQUFlO1FBRnJDLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNRLGVBQVUsR0FBVixVQUFVLENBQUs7UUFDNUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQzNDLENBQUM7SUFFRCxzQ0FBSSxHQUFKO1FBQUEsaUJBT0M7UUFOQyxJQUFJLENBQUMsNEJBQTRCLEVBQUUsQ0FBQztRQUVwQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUN2QyxJQUFNLGdCQUFnQixHQUFHLEtBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdkUsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQUMsS0FBa0IsSUFBSyxPQUFBLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQXhDLENBQXdDLENBQUMsQ0FBQztRQUM3RixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCwwQ0FBUSxHQUFSO1FBQUEsaUJBT0M7UUFOQyxJQUFJ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LEVBQUU7WUFDL0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLGtCQUFrQixFQUFFLFNBQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxhQUFhLE1BQUcsQ0FBQyxDQUFDO1lBQ3pGLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1NBQzdEO1FBRUQsb0NBQW9DO1FBQ3BDLElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFO1lBQzdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDNUM7SUFDSCxDQUFDOztnQkFqR1UsVUFBVTtnQkFDRixTQUFTO2dCQUNYLE1BQU07Z0RBQ3BCLE1BQU0sU0FBQyxXQUFXOztJQVRNO1FBQTFCLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQzsrRUFBNkM7SUFENUQsdUJBQXVCO1FBSG5DLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxvQkFBb0I7U0FDL0IsQ0FBQztRQVdHLFdBQUEsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFBO09BVlgsdUJBQXVCLENBeUduQztJQUFELDhCQUFDO0NBQUEsQUF6R0QsSUF5R0M7U0F6R1ksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIElucHV0LCBOZ1pvbmUsIEluamVjdCwgUExBVEZPUk1fSUQsIE9uSW5pdCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmRlY2xhcmUgdmFyIHJlcXVpcmU6IGFueTtcblxuLyoqXG4gKiBBbmd1bGFyIExhenkgTG9hZGluZyBJbWFnZXMgRGlyZWN0aXZlXG4gKlxuICogVGhlIGxpYnJhcnkgYWxsb3dzIHRvIGxhenkgbG9hZCBpbWFnZXMgZnJvbSB5b3VyIHdlYiBhcHBsaWNhdGlvblxuICogdXNpbmcgdGhlIE11dGF0aW9uT2JzZXJ2ZXIgYW5kIHRoZSBJbnRlcnNlY3Rpb25PYnNlcnZlci4gSW1hZ2VzIHdpbGwgYmUgbG9hZGVkIGFzXG4gKiBzb29uIGFzIHRoZXkgZW50ZXIgdGhlIHZpZXdwb3J0IGluIGEgbm9uLWJsb2NraW5nIHdheS5cbiAqL1xuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2xhenktbG9hZC1pbWFnZXNdJ1xufSlcbmV4cG9ydCBjbGFzcyBMYXp5TG9hZEltYWdlc0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCdsYXp5LWxvYWQtaW1hZ2VzJykgaW50ZXJzZWN0aW9uT2JzZXJ2ZXJDb25maWc6IG9iamVjdCB8IHN0cmluZztcblxuICBpbnRlcnNlY3Rpb25PYnNlcnZlcjogSW50ZXJzZWN0aW9uT2JzZXJ2ZXI7XG4gIHJvb3RFbGVtZW50OiBIVE1MRWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHB1YmxpYyBuZ1pvbmU6IE5nWm9uZSxcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IGFueSkge1xuICAgIHRoaXMucm9vdEVsZW1lbnQgPSBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMucmVnaXN0ZXJJbnRlcnNlY3Rpb25PYnNlcnZlcigpO1xuXG4gICAgdGhpcy5vYnNlcnZlRE9NQ2hhbmdlcyh0aGlzLnJvb3RFbGVtZW50LCAoKSA9PiB7XG4gICAgICBjb25zdCBpbWFnZXNGb3VuZEluRE9NID0gdGhpcy5nZXRBbGxJbWFnZXNUb0xhenlMb2FkKHRoaXMucm9vdEVsZW1lbnQpO1xuICAgICAgaW1hZ2VzRm91bmRJbkRPTS5mb3JFYWNoKChpbWFnZTogSFRNTEVsZW1lbnQpID0+IHRoaXMuaW50ZXJzZWN0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShpbWFnZSkpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQnJvd3NlcigpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmVxdWlyZSgnaW50ZXJzZWN0aW9uLW9ic2VydmVyJyk7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5pbml0KCkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuaW50ZXJzZWN0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuaW50ZXJzZWN0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIGlzQnJvd3NlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKTtcbiAgfVxuXG4gIHJlZ2lzdGVySW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKSB7XG4gICAgdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihcbiAgICAgIGltYWdlcyA9PiBpbWFnZXMuZm9yRWFjaChpbWFnZSA9PiB0aGlzLm9uSW50ZXJzZWN0aW9uQ2hhbmdlKGltYWdlKSksXG4gICAgICB0aGlzLmludGVyc2VjdGlvbk9ic2VydmVyQ29uZmlnIGluc3RhbmNlb2YgT2JqZWN0ID8gdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlckNvbmZpZyA6IHVuZGVmaW5lZFxuICAgICk7XG5cbiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlcjtcbiAgfVxuXG4gIG9ic2VydmVET01DaGFuZ2VzKHJvb3RFbGVtZW50OiBIVE1MRWxlbWVudCwgb25DaGFuZ2U6ICgpID0+IHZvaWQpIHtcbiAgICAvLyBDcmVhdGUgYSBNdXRhdGlvbiBPYnNlcnZlciBpbnN0YW5jZVxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gb25DaGFuZ2UoKSk7XG5cbiAgICAvLyBPYnNlcnZlciBDb25maWd1cmF0aW9uXG4gICAgY29uc3Qgb2JzZXJ2ZXJDb25maWcgPSB7XG4gICAgICBhdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZSxcbiAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgIHN1YnRyZWU6IHRydWVcbiAgICB9O1xuXG4gICAgLy8gT2JzZXJ2ZSBEaXJlY3RpdmUgRE9NIE5vZGVcbiAgICBvYnNlcnZlci5vYnNlcnZlKHJvb3RFbGVtZW50LCBvYnNlcnZlckNvbmZpZyk7XG5cbiAgICAvLyBGaXJlIG9uQ2hhbmdlIGNhbGxiYWNrIHRvIGNoZWNrIGN1cnJlbnQgRE9NIG5vZGVzXG4gICAgb25DaGFuZ2UoKTtcblxuICAgIHJldHVybiBvYnNlcnZlcjtcbiAgfVxuXG4gIGdldEFsbEltYWdlc1RvTGF6eUxvYWQocGFnZU5vZGU6IEhUTUxFbGVtZW50KSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20ocGFnZU5vZGUucXVlcnlTZWxlY3RvckFsbCgnaW1nW2RhdGEtc3JjXSwgW2RhdGEtc3Jjc2V0XSwgW2RhdGEtYmFja2dyb3VuZC1zcmNdJykpO1xuICB9XG5cbiAgb25JbnRlcnNlY3Rpb25DaGFuZ2UoaW1hZ2U6IGFueSkge1xuICAgIGlmICghaW1hZ2UuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLm9uSW1hZ2VBcHBlYXJzSW5WaWV3cG9ydChpbWFnZS50YXJnZXQpO1xuICB9XG5cbiAgb25JbWFnZUFwcGVhcnNJblZpZXdwb3J0KGltYWdlOiBhbnkpIHtcbiAgICBpZiAoaW1hZ2UuZGF0YXNldC5zcmMpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKGltYWdlLCAnc3JjJywgaW1hZ2UuZGF0YXNldC5zcmMpO1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUoaW1hZ2UsICdkYXRhLXNyYycpO1xuICAgIH1cblxuICAgIGlmIChpbWFnZS5kYXRhc2V0LnNyY3NldCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoaW1hZ2UsICdzcmNzZXQnLCBpbWFnZS5kYXRhc2V0LnNyY3NldCk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZShpbWFnZSwgJ2RhdGEtc3Jjc2V0Jyk7XG4gICAgfVxuXG4gICAgaWYgKGltYWdlLmRhdGFzZXQuYmFja2dyb3VuZFNyYykge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShpbWFnZSwgJ2JhY2tncm91bmQtaW1hZ2UnLCBgdXJsKCR7aW1hZ2UuZGF0YXNldC5iYWNrZ3JvdW5kU3JjfSlgKTtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGltYWdlLCAnZGF0YS1iYWNrZ3JvdW5kLXNyYycpO1xuICAgIH1cblxuICAgIC8vIFN0b3Agb2JzZXJ2aW5nIHRoZSBjdXJyZW50IHRhcmdldFxuICAgIGlmICh0aGlzLmludGVyc2VjdGlvbk9ic2VydmVyKSB7XG4gICAgICB0aGlzLmludGVyc2VjdGlvbk9ic2VydmVyLnVub2JzZXJ2ZShpbWFnZSk7XG4gICAgfVxuICB9XG59XG4iXX0=